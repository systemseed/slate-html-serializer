!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("react-dom/server"),require("type-of"),require("slate"),require("immutable")):"function"==typeof define&&define.amd?define(["exports","react","react-dom/server","type-of","slate","immutable"],r):r(e.SkorzhSlateHtmlSerializer={},e.React,e.ReactDOMServer,e.typeOf,e.Slate,e.Immutable)}(this,function(e,r,t,a,n,i){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a;var o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},l=new i.Record({object:"string",text:""}),u={deserialize:function(e){if(e.tagName&&"br"===e.tagName.toLowerCase())return{object:"text",leaves:[{object:"leaf",text:"\n"}]};if("#text"==e.nodeName){if(e.nodeValue&&e.nodeValue.match(/<!--.*?-->/))return;return{object:"text",leaves:[{object:"leaf",text:e.nodeValue}]}}},serialize:function(e,t){if("string"===e.object)return t.split("\n").reduce(function(e,t,a){return 0!=a&&e.push(r.createElement("br",{key:a})),e.push(t),e},[])}};function s(e){if("undefined"==typeof DOMParser)throw new Error("The native `DOMParser` global which the `Html` serializer uses by default is not present in this environment. You must supply the `options.parseHtml` function instead.");return(new DOMParser).parseFromString(e,"text/html").body}var c=function(){var e=this;this.deserialize=function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||"<p></p>";var a=t.toJSON,i=void 0!==a&&a,l=e.defaultBlock,u=(0,e.parseHtml)(r),s=Array.from(u.childNodes),c=e.deserializeElements(s);0==(c=c.reduce(function(e,r,t,a){if("block"==r.object)return e.push(r),e;if(t>0&&"block"!=a[t-1].object)return e[e.length-1].nodes.push(r),e;var n=o({object:"block",data:{},isVoid:!1},l,{nodes:[r]});return e.push(n),e},[])).length&&(c=[o({object:"block",data:{},isVoid:!1},l,{nodes:[{object:"text",leaves:[{object:"leaf",text:"",marks:[]}]}]})]);var f={object:"value",document:{object:"document",data:{},nodes:c}};return i?f:n.Value.fromJSON(f)},this.deserializeElements=function(){var r=[];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(e.cruftNewline).forEach(function(t){var n=e.deserializeElement(t);switch(a(n)){case"array":r=r.concat(n);break;case"object":r.push(n)}}),r},this.deserializeElement=function(r){var t=void 0;r.tagName||(r.tagName="");var n=function(r){switch("[object NodeList]"==Object.prototype.toString.call(r)&&(r=Array.from(r)),a(r)){case"array":return e.deserializeElements(r);case"object":return e.deserializeElement(r);case"null":case"undefined":return;default:throw new Error('The `next` argument was called with invalid children: "'+r+'".')}},i=!0,o=!1,l=void 0;try{for(var u,s=e.rules[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;if(c.deserialize){var f=c.deserialize(r,n),d=a(f);if("array"!=d&&"object"!=d&&"null"!=d&&"undefined"!=d)throw new Error('A rule returned an invalid deserialized representation: "'+t+'".');if(void 0!==f){if(null===f)return null;t="mark"==f.object?e.deserializeMark(f):f;break}}}}catch(e){o=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw l}}return t||n(r.childNodes)},this.deserializeMark=function(r){var t=r.type,a=r.data;return r.nodes.reduce(function(r,n){var i=function r(n){return"mark"==n.object?e.deserializeMark(n):("text"==n.object?n.leaves=n.leaves.map(function(e){return e.marks=e.marks||[],e.marks.push({type:t,data:a}),e}):n.nodes=n.nodes.map(r),n)}(n);return Array.isArray(i)?r.concat(i):(r.push(i),r)},[])},this.serialize=function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.document.nodes.map(e.serializeNode).filter(function(e){return e});return!1===n.render?i:t.renderToStaticMarkup(r.createElement("body",null,i.toArray())).slice(6,-7)},this.serializeNode=function(r){if("text"===r.object)return r.getLeaves().map(e.serializeLeaf).toArray();var t=r.nodes.map(e.serializeNode),a=!0,n=!1,i=void 0;try{for(var o,l=e.rules[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;if(u.serialize){var s=u.serialize(r,t.toArray());if(null===s)return;if(s)return d(s)}}}catch(e){n=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw i}}throw new Error('No serializer defined for node of type "'+r.type+'".')},this.serializeLeaf=function(r){var t=new l({text:r.text}),a=e.serializeString(t);return r.marks.reduce(function(r,t){var a=!0,n=!1,i=void 0;try{for(var o,l=e.rules[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;if(u.serialize){var s=u.serialize(t,r);if(null===s)return;if(s)return d(s)}}}catch(e){n=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw i}}throw new Error('No serializer defined for mark of type "'+t.type+'".')},a)},this.serializeString=function(r){var t=!0,a=!1,n=void 0;try{for(var i,o=e.rules[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;if(l.serialize){var u=l.serialize(r,r.text);if(u)return u}}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}},this.cruftNewline=function(e){return!("#text"===e.nodeName&&"\n"==e.nodeValue)}},f=0;function d(e){return r.cloneElement(e,{key:f++})}e.default=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),c.call(this);var t=r.defaultBlock,a=void 0===t?"paragraph":t,i=r.parseHtml,o=void 0===i?s:i,l=r.rules,f=void 0===l?[]:l;a=n.Node.createProperties(a),this.rules=[].concat(function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(f),[u]),this.defaultBlock=a,this.parseHtml=o},Object.defineProperty(e,"__esModule",{value:!0})});
